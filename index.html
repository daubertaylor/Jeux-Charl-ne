<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Flappy Heart Cartoon ❤️</title>
<style>
  /* Reset */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  html, body {
    height: 100%;
    background: linear-gradient(to top, #87ceeb 0%, #a7d8f7 100%);
    font-family: 'Comic Sans MS', cursive, sans-serif;
    user-select: none;
    overflow: hidden;
  }
  #gameContainer {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    display: block;
    background: linear-gradient(to top, #87ceeb 0%, #a7d8f7 100%);
  }

  /* Ville en 3 plans pour effet profondeur */
  #cityLayer1, #cityLayer2, #cityLayer3 {
    position: absolute;
    bottom: 0;
    width: 100%;
    pointer-events: none;
  }
  #cityLayer1 {
    height: 25%;
    z-index: 1;
  }
  #cityLayer2 {
    height: 15%;
    z-index: 2;
    filter: brightness(0.85);
  }
  #cityLayer3 {
    height: 10%;
    z-index: 3;
    filter: brightness(0.75);
  }

  /* Nuages */
  #cloudLayer {
    position: absolute;
    top: 5%;
    width: 100%;
    height: 25%;
    pointer-events: none;
    z-index: 5;
  }
  .cloud {
    position: absolute;
    background: #fff;
    border-radius: 50% / 60%;
    opacity: 0.85;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.1));
  }

  /* Message de fin */
  #messageBox {
    position: absolute;
    top: 40%;
    width: 100%;
    text-align: center;
    font-size: 1.8em;
    color: #d6366e;
    text-shadow: 1px 1px 2px #fff;
    display: none;
    z-index: 10;
  }
  #restartBtn {
    margin-top: 20px;
    padding: 12px 28px;
    font-size: 1.3em;
    border: none;
    background: #d6366e;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 8px #b32e61;
    transition: background 0.3s ease;
  }
  #restartBtn:hover {
    background: #a62b51;
  }

  /* Score */
  #scoreDisplay {
    position: absolute;
    top: 18px;
    left: 20px;
    font-size: 2em;
    color: #d6366e;
    text-shadow: 1px 1px 3px white;
    font-weight: bold;
    z-index: 11;
  }
</style>
</head>
<body>
<div id="gameContainer">

  <!-- Décor ville (3 plans) -->
  <svg id="cityLayer1" viewBox="0 0 1000 250" preserveAspectRatio="xMidYMax meet"></svg>
  <svg id="cityLayer2" viewBox="0 0 1000 150" preserveAspectRatio="xMidYMax meet"></svg>
  <svg id="cityLayer3" viewBox="0 0 1000 100" preserveAspectRatio="xMidYMax meet"></svg>

  <!-- Nuages -->
  <svg id="cloudLayer" viewBox="0 0 1000 250" preserveAspectRatio="xMidYMax meet"></svg>

  <!-- Canvas jeu -->
  <canvas id="gameCanvas"></canvas>

  <!-- Score -->
  <div id="scoreDisplay">Score : 0</div>

  <!-- Message fin -->
  <div id="messageBox">
    <div>Ne t’inquiète pas, tu voleras plus haut la prochaine fois ! ❤️</div>
    <button id="restartBtn">Rejouer</button>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreDisplay = document.getElementById('scoreDisplay');
  const messageBox = document.getElementById('messageBox');
  const restartBtn = document.getElementById('restartBtn');

  // Dimensions
  let W = window.innerWidth;
  let H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;

  // Redimensionnement responsive
  window.addEventListener('resize', () => {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  });

  // ----------- PERSONNAGE : CŒUR SVG animé en canvas -----------

  // Fonction dessin cœur cartoon (style « bulbe »)
  function drawHeart(ctx, x, y, size, scale = 1, rotation = 0) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    ctx.scale(scale, scale);
    ctx.fillStyle = '#e63946';
    ctx.strokeStyle = '#b22234';
    ctx.lineWidth = 3;
    ctx.shadowColor = 'rgba(230,57,70,0.8)';
    ctx.shadowBlur = 15;

    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.bezierCurveTo(-size * 0.6, -size * 0.7, -size, size * 0.4, 0, size);
    ctx.bezierCurveTo(size, size * 0.4, size * 0.6, -size * 0.7, 0, 0);
    ctx.fill();
    ctx.stroke();

    // Petit éclat blanc pour effet cartoon
    ctx.beginPath();
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.ellipse(-size * 0.25, -size * 0.15, size * 0.15, size * 0.2, 0, 0, 2 * Math.PI);
    ctx.fill();

    ctx.restore();
  }

  class Heart {
    constructor() {
      this.x = W * 0.2;
      this.y = H / 2;
      this.size = 25;
      this.velocity = 0;
      this.gravity = 0.7;
      this.lift = -12;
      this.maxVelocity = 15;
      this.animationTick = 0;
    }
    update() {
      this.velocity += this.gravity;
      if (this.velocity > this.maxVelocity) this.velocity = this.maxVelocity;
      this.y += this.velocity;

      // Limites écran vertical
      if (this.y + this.size > H) {
        this.y = H - this.size;
        this.velocity = 0;
      }
      if (this.y - this.size < 0) {
        this.y = this.size;
        this.velocity = 0;
      }

      // Battement cœur (oscillation scale & légère rotation)
      this.animationTick += 0.15;
      this.scale = 1 + 0.08 * Math.sin(this.animationTick * 3);
      this.rotation = 0.05 * Math.sin(this.animationTick * 5);
    }
    fly() {
      this.velocity = this.lift;
    }
    draw() {
      drawHeart(ctx, this.x, this.y, this.size, this.scale, this.rotation);
    }
  }

  // ----------- OBSTACLES : Troncs d'arbre détaillés -----------

  class Trunk {
    constructor(x) {
      this.x = x;
      this.width = 55;
      this.gap = 160;
      this.topHeight = Math.floor(Math.random() * (H / 2)) + 70;
      this.speed = 3;
      this.scored = false;
    }
    update() {
      this.x -= this.speed;
      if (this.x + this.width < 0) {
        this.x = W + 200;
        this.topHeight = Math.floor(Math.random() * (H / 2)) + 70;
        this.scored = false;
      }
    }
    draw() {
      // Tronc haut
      this.drawBark(this.x, 0, this.width, this.topHeight);
      // Tronc bas
      this.drawBark(this.x, this.topHeight + this.gap, this.width, H - (this.topHeight + this.gap));
    }
    drawBark(x, y, w, h) {
      // Base tronc
      ctx.fillStyle = '#7b5e2e';
      ctx.strokeStyle = '#4b3b1b';
      ctx.lineWidth = 3;
      ctx.shadowColor = 'rgba(0,0,0,0.1)';
      ctx.shadowBlur = 5;
      ctx.fillRect(x, y, w, h);
      ctx.strokeRect(x, y, w, h);

      // Lignes verticales style écorce
      ctx.strokeStyle = '#5c4a1c';
      ctx.lineWidth = 2;
      for (let i = 0; i < 6; i++) {
        const lineX = x + 6 + i * 8;
        ctx.beginPath();
        ctx.moveTo(lineX, y);
        ctx.lineTo(lineX, y + h);
        ctx.stroke();
      }

      // Cercles pour noeuds
      ctx.fillStyle = '#5c4a1c';
      for (let i = 0; i < 4; i++) {
        let circleY = y + (i + 1) * (h / 5);
        let circleX = x + 10 + (i % 2) * 15;
        ctx.beginPath();
        ctx.ellipse(circleX, circleY, 5, 8, 0, 0, 2 * Math.PI);
        ctx.fill();
      }
    }
  }

  // ----------- DECOR : Ville cartoon en SVG -----------

  // Création bâtiments stylisés dans 3 plans avec nuance pour profondeur
  function createBuildings(svgEl, baseHeight, count, colorBase, colorShadow) {
    const widthMax = 60;
    const widthMin = 35;
    const spacing = 
