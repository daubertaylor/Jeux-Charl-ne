<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flappy Heart Cartoon Amélioré</title>
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden; height: 100%;
    background: linear-gradient(to top, #87ceeb, #cfe8ff);
    font-family: 'Comic Sans MS', cursive, sans-serif;
    user-select: none;
  }
  #score {
    position: fixed;
    top: 20px; left: 50%;
    transform: translateX(-50%);
    font-size: 32px;
    font-weight: bold;
    color: #2c3e50;
    text-shadow: 2px 2px 5px #ecf0f1;
    z-index: 10;
  }
  #gameOverMessage {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255 255 255 / 0.95);
    padding: 30px 40px;
    border-radius: 25px;
    box-shadow: 0 10px 35px rgba(0,0,0,0.4);
    font-size: 26px;
    color: #e74c3c;
    font-weight: 700;
    text-align: center;
    max-width: 90vw;
    z-index: 20;
    display: none;
  }
  #restartBtn {
    margin-top: 20px;
    padding: 14px 32px;
    font-size: 22px;
    font-weight: 700;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 18px;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(231, 76, 60, 0.7);
  }
  #restartBtn:hover {
    background: #c0392b;
  }
  canvas {
    display: block;
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: transparent;
    z-index: 1;
  }
</style>
</head>
<body>

<div id="score">Score: 0</div>
<div id="gameOverMessage">
  <div>Comme c’est pas grave mon amour,<br>chaque essai te rapproche plus près du ciel.</div>
  <button id="restartBtn">Rejouer</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const gameOverMessage = document.getElementById('gameOverMessage');
  const restartBtn = document.getElementById('restartBtn');

  let W, H;
  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  }
  resize();
  window.addEventListener('resize', resize);

  // GAME VARIABLES
  let bird, pipes, frameCount, score, gameOver;

  // CONSTANTS
  const gravity = 0.5;
  const jumpForce = -11;
  const pipeWidth = 80;
  const pipeGap = H * 0.35;
  const groundHeight = H * 0.14;
  const pipeSpeed = 5;

  // Animated Heart (bird) with breathing scale effect
  function createBird() {
    return {
      x: W * 0.25,
      y: H / 2,
      baseSize: 52,
      size: 52,
      velocity: 0,
      frame: 0,
      update() {
        this.velocity += gravity;
        this.y += this.velocity;

        if(this.y + this.size/2 > H - groundHeight) {
          this.y = H - groundHeight - this.size/2;
          this.velocity = 0;
          gameOver = true;
        }
        if(this.y - this.size/2 < 0) {
          this.y = this.size/2;
          this.velocity = 0;
          gameOver = true;
        }

        // Breathing animation
        this.frame += 0.07;
        this.size = this.baseSize + 4 * Math.sin(this.frame);
      },
      jump() {
        this.velocity = jumpForce;
      },
      draw() {
        const x = this.x;
        const y = this.y;
        const s = this.size;

        // Heart shape path - cartoon style
        ctx.save();

        // Shadow glow
        ctx.shadowColor = 'rgba(255, 0, 50, 0.9)';
        ctx.shadowBlur = 18;

        // Create gradient fill
        const grad = ctx.createRadialGradient(x, y, s*0.1, x, y, s*0.6);
        grad.addColorStop(0, '#ff416c');
        grad.addColorStop(0.6, '#e60039');
        grad.addColorStop(1, '#930026');
        ctx.fillStyle = grad;

        ctx.beginPath();
        const topCurveHeight = s * 0.3;

        ctx.moveTo(x, y + s * 0.25);
        ctx.bezierCurveTo(x - s * 0.5, y - topCurveHeight, x - s * 0.7, y + s * 0.6, x, y + s * 0.9);
        ctx.bezierCurveTo(x + s * 0.7, y + s * 0.6, x + s * 0.5, y - topCurveHeight, x, y + s * 0.25);
        ctx.closePath();
        ctx.fill();

        // Heart outline
        ctx.shadowColor = 'transparent';
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#ff94a8';
        ctx.stroke();

        ctx.restore();
      }
    };
  }

  // Pipe class - cartoon trunks with simple leaf top
  class Pipe {
    constructor(x) {
      this.x = x;
      this.width = pipeWidth;
      this.gap = pipeGap;
      const minHeight = 110;
      this.topHeight = minHeight + Math.random() * (H - groundHeight - this.gap - minHeight);
      this.passed = false;
    }
    update() {
      this.x -= pipeSpeed;
    }
    draw() {
      // Draw pipe trunks - brown with wood texture lines
      const grad = ctx.createLinearGradient(this.x, 0, this.x + this.width, 0);
      grad.addColorStop(0, '#654321');
      grad.addColorStop(1, '#a97448');

      // Top trunk
      ctx.fillStyle = grad;
      ctx.fillRect(this.x, 0, this.width, this.topHeight);

      // Bottom trunk
      ctx.fillRect(this.x, this.topHeight + this.gap, this.width, H - groundHeight - (this.topHeight + this.gap));

      // Wood texture lines
      ctx.strokeStyle = '#4b3200';
      ctx.lineWidth = 2;
      const lineCount = 8;
      for(let i=1; i <= lineCount; i++) {
        let y = (this.topHeight / lineCount) * i;
        ctx.beginPath();
        ctx.moveTo(this.x, y);
        ctx.lineTo(this.x + this.width, y + (i % 2 ? 3 : -3));
        ctx.stroke();

        y = this.topHeight + this.gap + ((H - groundHeight - (this.topHeight + this.gap)) / lineCount) * i;
        ctx.beginPath();
        ctx.moveTo(this.x, y);
        ctx.lineTo(this.x + this.width, y + (i % 2 ? 3 : -3));
        ctx.stroke();
      }

      // Leaf tops (cartoon simple)
      const leafHeight = 25;
      ctx.fillStyle = '#2ecc71';
      ctx.beginPath();
      ctx.moveTo(this.x - 10, this.topHeight);
      ctx.lineTo(this.x + this.width / 2, this.topHeight - leafHeight);
      ctx.lineTo(this.x + this.width + 10, this.topHeight);
      ctx.closePath();
      ctx.fill();

      ctx.beginPath();
      ctx.moveTo(this.x - 10, this.topHeight + this.gap + (H - groundHeight - (this.topHeight + this.gap)));
      ctx.lineTo(this.x + this.width / 2, this.topHeight + this.gap + (H - groundHeight - (this.topHeight + this.gap)) - leafHeight);
      ctx.lineTo(this.x + this.width + 10, this.topHeight + this.gap + (H - groundHeight - (this.topHeight + this.gap)));
      ctx.closePath();
      ctx.fill();

      // Outline trunks
      ctx.strokeStyle = '#2d1f00';
      ctx.lineWidth = 3;
      ctx.strokeRect(this.x, 0, this.width, this.topHeight);
      ctx.strokeRect(this.x, this.topHeight + this.gap, this.width, H - groundHeight - (this.topHeight + this.gap));
    }
  }

  // Background with trees, houses and road
  function drawBackground() {
    // Sky already done in body bg, here add details

    // Ground
    const groundY = H - groundHeight;
    const groundGrad = ctx.createLinearGradient(0, groundY, 0, H);
    groundGrad.addColorStop(0, '#40601b');
    groundGrad.addColorStop(1, '#2a3b10');
    ctx.fillStyle = groundGrad;
    ctx.fillRect(0, groundY, W, groundHeight);

    // Draw road
    const roadY = groundY + groundHeight * 0.5;
    const roadHeight = groundHeight * 0.35;
    ctx.fillStyle = '#444';
    ctx.fillRect(0, roadY, W, roadHeight);

    // Road lines
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 4;
    ctx.setLineDash([30, 25]);
    ctx.beginPath();
    ctx.moveTo(0, roadY + roadHeight / 2);
    ctx.lineTo(W, roadY + roadHeight / 2);
    ctx.stroke();
    ctx.setLineDash([]);

    // Trees - cartoon simple trees spaced horizontally with small sway
    const treeCount = 9;
    const treeSpacing = W / treeCount;
    const swayAmplitude = 4;
    const swaySpeed = 0.005;

    for(let i=0; i<treeCount; i++) {
      const baseX = i * treeSpacing + treeSpacing * 0.5;
      const sway = Math.sin(frameCount * swaySpeed + i) * swayAmplitude;

      // Trunk
      ctx.fillStyle = '#5d3a00';
      ctx.fillRect(baseX + sway, groundY - 80, 12, 80);

      // Leaves (3 stacked circles)
      ctx.fillStyle = '#27ae60';
      ctx.beginPath();
      ctx.ellipse(baseX + sway + 6, groundY - 95, 20, 25, 0, 0, Math.PI * 2);
      ctx.ellipse(baseX + sway - 10, groundY - 80, 18, 20, 0, 0, Math.PI * 2);
      ctx.ellipse(baseX + sway + 20, groundY - 80, 18, 20, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = '#1e6b1e';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.ellipse(baseX + sway + 6, groundY - 95, 20, 25, 0, 0, Math.PI * 2);
      ctx.ellipse(baseX + sway - 10, groundY - 80, 18, 20, 0, 0, Math.PI * 2);
      ctx.ellipse(baseX + sway + 20, groundY - 80, 18, 20, 0, 0, Math.PI * 2);
      ctx.stroke();
    }

    // Houses - simple cartoon houses spaced in front of trees
    const houseCount = 5;
    for(let i=0; i<houseCount; i++) {
      const baseX = (i + 0.3) * W / houseCount;
      const baseY = groundY - 40;
      // House base
      ctx.fillStyle = '#e74c3c';
      ctx.fillRect(baseX, baseY, 70, 50);

      // Roof
      ctx.fillStyle = '#c0392b';
      ctx.beginPath();
      ctx.moveTo(baseX - 10, baseY);
      ctx.lineTo(baseX + 35, baseY - 40);
      ctx.lineTo(baseX + 80, baseY);
      ctx.closePath();
      ctx.fill();

      // Door
      ctx.fillStyle = '#7f3d2a';
      ctx.fillRect(baseX + 28, baseY + 25, 14, 25);

      // Windows
      ctx.fillStyle = '#f9e79f';
      ctx.fillRect(baseX + 10, baseY + 15, 18, 18);
      ctx.fillRect(baseX + 42, baseY + 15, 18, 18);

      // Window frames
      ctx.strokeStyle = '#7f3d2a';
      ctx.lineWidth = 2;
      ctx.strokeRect(baseX + 10, baseY + 15, 18, 18);
      ctx.strokeRect(baseX + 42, baseY + 15, 18, 18);
      ctx.beginPath();
      ctx.moveTo(baseX + 19, baseY + 15);
      ctx.lineTo(baseX + 19, baseY + 33);
      ctx.moveTo(baseX + 10, baseY + 24);
      ctx.lineTo(baseX + 28, baseY + 24);
      ctx.moveTo(baseX + 51, baseY + 15);
      ctx.lineTo(baseX + 51, baseY + 33);
      ctx.moveTo(baseX + 42, baseY + 24);
      ctx.lineTo(baseX + 60, baseY + 24);
      ctx.stroke();
    }

    // Small cars on road moving left to right (cartoon)
    const carWidth = 60;
    const carHeight = 30;
    const carY = roadY + roadHeight/2 + 5;
    const carColors = ['#3498db', '#e67e22', '#9b59b6', '#1abc9c'];
    for(let i=0; i<3; i++) {
      const speed = 2 + i * 0.7;
      const offset = (frameCount * speed + i * 200)
